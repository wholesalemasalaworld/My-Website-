<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wholesale Masala World</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { background: #fff; color: #1a2a33; font-family: sans-serif; }
        .hidden { display: none !important; }
        header { background: #1a2a33; color: #f1c40f; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 500px; margin: auto; padding: 10px; }
        .product-card { border: 1px solid #eee; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; background: #fff; }
        .img-box { position: relative; width: 100%; height: 220px; background: #f4f4f4; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; scroll-snap-align: start; min-width: 100%; }
        .details { padding: 12px; }
        .p-name { color: #ff4d4d; font-size: 1.2rem; font-weight: bold; }
        .p-price { color: #58d68d; font-size: 1.3rem; font-weight: bold; margin: 5px 0; }
        select, input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #00bcd4; border-radius: 8px; font-size: 16px; }
        .btn { background: #1a2a33; color: #fff; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-buy { background: #58d68d; padding: 15px; font-size: 1.1rem; margin-top: 10px; color: #000; }
        .cart-bar { position: fixed; bottom: 15px; right: 15px; background: #00bcd4; color: #fff; padding: 12px 20px; border-radius: 50px; font-weight: bold; z-index: 99; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #cart-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 200; overflow-y: auto; padding: 15px; }
        .payment-box { background: #f0fbff; border: 1px dashed #00bcd4; padding: 15px; border-radius: 10px; margin-top: 10px; }
        .adv-tag { color: red; font-weight: bold; font-size: 0.8rem; display: block; margin-bottom: 5px; text-align: center; }
    </style>
</head>
<body onload="renderProducts()">

<header><h1>Wholesale Masala World</h1></header>

<div class="cart-bar" onclick="openCart()">üõí <span id="count">0</span> Items | Checkout</div>

<div class="container" id="main-view">
    <div id="masala-list"></div>
</div>

<div id="cart-modal" class="hidden">
    <button onclick="window.history.back()" style="background:none; border:none; color:#00bcd4; font-size:1rem; padding:10px 0;">‚Üê Back</button>
    <h2 style="margin:10px 0;">Order Summary</h2>
    <div id="items-list"></div>
    <h3 style="text-align:right; margin:15px 0; border-top:1px solid #eee; padding-top:10px;">Total Bill: ‚Çπ<span id="total">0</span></h3>
    
    <form id="orderForm">
        <input type="text" id="custName" placeholder="Full Name" required>
        <textarea id="custAddr" placeholder="Delivery Address" rows="2" required></textarea>
        <input type="text" id="custPin" placeholder="Pincode (6 digits)" pattern="[0-9]{6}" required>
        
        <label class="adv-tag">‚ö†Ô∏è 30% Advance is Mandatory for all methods</label>
        <select id="payMethod" onchange="updatePaymentUI()" required>
            <option value="">Select Payment Method</option>
            <option value="UPI">Full UPI / Advance UPI</option>
            <option value="COD">COD (30% Advance Mandatory)</option>
            <option value="Bank">Bank Transfer (30% Advance)</option>
        </select>

        <div id="payment-display" class="payment-box hidden">
            <div id="qr-area" class="hidden" style="text-align:center;">
                <p style="margin-bottom:5px; font-size:0.9rem;">Scan to pay 30% Advance</p>
                <img id="upi-qr" src="" style="width:180px; height:180px; border:2px solid #fff;">
                <p style="font-size:0.75rem; color:#555; margin-top:5px;">UPI: sorthivinay0047@oksbi</p>
            </div>

            <div id="cust-bank-area" class="hidden">
                <p style="font-size:0.8rem; color:#ff4d4d; margin-bottom:5px; font-weight:bold;">Details of Account you paid from:</p>
                <input list="bank-list" id="custBankName" placeholder="Search Bank Name (SBI, HDFC...)">
                <datalist id="bank-list">
                    <option value="State Bank of India"><option value="HDFC Bank"><option value="ICICI Bank">
                    <option value="Axis Bank"><option value="Bank of Baroda"><option value="Punjab National Bank">
                    <option value="Canara Bank"><option value="Union Bank of India"><option value="Bank of India">
                    <option value="Indian Bank"><option value="Central Bank of India"><option value="Indian Overseas Bank">
                    <option value="UCO Bank"><option value="Bank of Maharashtra"><option value="Punjab & Sind Bank">
                    <option value="Kotak Mahindra Bank"><option value="IndusInd Bank"><option value="Yes Bank">
                    <option value="IDFC FIRST Bank"><option value="Federal Bank"><option value="RBL Bank">
                    <option value="South Indian Bank"><option value="Bandhan Bank"><option value="Karur Vysya Bank">
                    <option value="Karnataka Bank"><option value="City Union Bank"><option value="Dhanlaxmi Bank">
                    <option value="Tamilnad Mercantile Bank"><option value="CSB Bank"><option value="Jammu & Kashmir Bank">
                    <option value="AU Small Finance Bank"><option value="Equitas Small Finance Bank">
                </datalist>
                <input type="text" id="custAccHolder" placeholder="Account Holder Name">
                <input type="text" id="custAccNum" placeholder="Account Number">
                <input type="text" id="custIFSC" placeholder="IFSC Code">
            </div>

            <input type="text" id="utr" placeholder="Transaction ID / UTR Number" required>
        </div>

        <button type="submit" id="submitBtn" class="btn btn-buy">Submit Order & WhatsApp</button>
    </form>
</div>

<script>
    const products = [
        { name: "Shahi Jeera", mrp: 850, imgs: ["https://i.ibb.co/NgL1xGhX/shahi-jeera-1.jpg", "https://i.ibb.co/JRdKZzNR/shahi-jeera-2.jpg"] },
        { name: "Premium Loang", mrp: 1100, imgs: ["https://images.unsplash.com/photo-1615485290382-441e4d049cb5?w=400"] },
        { name: "Green Elaichi", mrp: 3200, imgs: ["https://images.unsplash.com/photo-1601004890684-d8cbf643f5f2?w=400"] }
    ];

    let cart = [];
    window.onpopstate = () => document.getElementById('cart-modal').classList.add('hidden');

    function renderProducts() {
        const list = document.getElementById('masala-list');
        list.innerHTML = "";
        products.forEach((p, idx) => {
            let sale = Math.round(p.mrp * 0.65);
            let imgHTML = p.imgs.map(s => `<img src="${s}">`).join('');
            list.innerHTML += `<div class="product-card"><div class="img-box">${imgHTML}</div>
                <div class="details"><p class="p-name">${p.name}</p><p class="p-price">‚Çπ${sale}/kg</p>
                <select id="qty-${idx}"><option value="6">6kg</option><option value="10">10kg</option></select>
                <button class="btn" onclick="add(${idx})">Add to Order</button></div></div>`;
        });
    }

    function add(idx) {
        const qty = document.getElementById(`qty-${idx}`).value;
        const p = products[idx];
        cart.push({ n: p.name, q: qty, t: Math.round(p.mrp * 0.65) * qty });
        document.getElementById('count').innerText = cart.length;
        alert("Added!");
    }

    function openCart() {
        if(!cart.length) return alert("Cart is empty!");
        history.pushState({p:'c'}, "", "#order");
        document.getElementById('cart-modal').classList.remove('hidden');
        let h = ""; let t = 0;
        cart.forEach((i, idx) => { h += `<p>‚úÖ ${i.n} (${i.q}kg) - ‚Çπ${i.t} <span onclick="del(${idx})" style="color:red; float:right;">‚úñ</span></p>`; t += i.t; });
        document.getElementById('total').innerText = t;
        document.getElementById('items-list').innerHTML = h;
    }

    function del(idx) { cart.splice(idx,1); if(!cart.length) window.history.back(); else openCart(); }

    function updatePaymentUI() {
        const method = document.getElementById('payMethod').value;
        const display = document.getElementById('payment-display');
        const qr = document.getElementById('qr-area');
        const bankArea = document.getElementById('cust-bank-area');
        
        display.classList.toggle('hidden', method === "");
        qr.classList.toggle('hidden', method === "Bank" || method === "");
        bankArea.classList.toggle('hidden', method !== "Bank");

        bankArea.querySelectorAll('input').forEach(i => i.required = (method === "Bank"));

        if(method === "UPI" || method === "COD") {
            const amt = Math.round(document.getElementById('total').innerText * 0.30);
            document.getElementById('upi-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=sorthivinay0047@oksbi&pn=MasalaWorld&am=${amt}&cu=INR`;
        }
    }

    document.getElementById('orderForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.innerText = "Sending..."; btn.disabled = true;

        const data = {
            Name: document.getElementById('custName').value,
            Address: document.getElementById('custAddr').value,
            Payment: document.getElementById('payMethod').value,
            UTR: document.getElementById('utr').value,
            Bank: document.getElementById('custBankName').value || "N/A",
            AccNum: document.getElementById('custAccNum').value || "N/A",
            IFSC: document.getElementById('custIFSC').value || "N/A",
            Order: cart.map(i => `${i.n}(${i.q}kg)`).join(', '),
            Total: document.getElementById('total').innerText
        };

        fetch('https://formspree.io/f/xrelkgbz', {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' }
        }).then(() => {
            const msg = encodeURIComponent(`Naya Order!\nNaam: ${data.Name}\nTotal: ‚Çπ${data.Total}\nUTR: ${data.UTR}`);
            window.location.href = `https://wa.me/918460722331?text=${msg}`;
        });
    });
</script>
</body>
</html>
