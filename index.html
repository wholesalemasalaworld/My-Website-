<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wholesale Masala World</title>
    <style>
        /* Speed Optimized CSS */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        body { background: #fff; color: #1a2a33; font-family: -apple-system, sans-serif; line-height: 1.5; }
        .hidden { display: none !important; }
        
        header { background: #1a2a33; color: #f1c40f; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 500px; margin: auto; padding: 10px; }

        /* Performance Optimized Product Card */
        .product-card { border: 1px solid #eee; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; }
        .img-box { position: relative; width: 100%; height: 200px; background: #f4f4f4; }
        .slider-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .slider-img.active { display: block; }
        
        .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.3); color: #fff; border: none; padding: 8px; border-radius: 50%; cursor: pointer; }
        .prev { left: 5px; } .next { right: 5px; }

        .details { padding: 12px; }
        .p-name { color: #ff4d4d; font-size: 1.1rem; font-weight: bold; }
        .p-price { color: #58d68d; font-size: 1.2rem; font-weight: bold; margin: 4px 0; }
        
        select, input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #00bcd4; border-radius: 6px; font-size: 16px; background: #fff; }
        
        .btn { background: #1a2a33; color: #fff; border: none; padding: 12px; border-radius: 6px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-buy { background: #58d68d; padding: 15px; font-size: 1.1rem; margin-top: 10px; }

        .cart-bar { position: fixed; bottom: 15px; right: 15px; background: #00bcd4; color: #fff; padding: 10px 18px; border-radius: 30px; font-weight: bold; z-index: 99; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        #cart-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 200; overflow-y: auto; padding: 15px; }
    </style>
</head>
<body onload="renderProducts()">

<header><h1>Wholesale Masala World</h1></header>

<div class="cart-bar" onclick="openCart()">üõí <span id="count">0</span> Items | Buy</div>

<div class="container" id="main-view">
    <div id="masala-list"></div>
</div>

<div id="cart-modal" class="hidden">
    <button onclick="window.history.back()" style="background:none; border:none; color:#00bcd4; font-size:1rem;">‚Üê Back</button>
    <h2 style="margin:15px 0;">Order Summary</h2>
    <div id="items-list"></div>
    <h3 style="text-align:right; margin:10px 0;">Total: ‚Çπ<span id="total">0</span></h3>
    <form action="https://formspree.io/f/xrelkgbz" method="POST" onsubmit="return handleOrder(event)">
        <input type="hidden" name="Order" id="hidden-data">
        <input type="text" name="Name" placeholder="Name" required>
        <textarea name="Address" placeholder="Address" rows="2" required></textarea>
        <input type="text" name="Pin" placeholder="Pincode" pattern="[0-9]{6}" required>
        <select name="Pay" id="pay-mode" onchange="document.getElementById('qr').classList.toggle('hidden', this.value==='')" required>
            <option value="">Payment Method</option>
            <option value="UPI">Full UPI</option>
            <option value="COD">COD (30% Advance)</option>
        </select>
        <div id="qr" class="hidden" style="text-align:center;">
            <p style="color:red; font-size:0.8rem;">Scan & Pay Advance/Full</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=8460722331@okicici" alt="QR" style="margin:10px 0;">
            <input type="text" name="UTR" placeholder="Transaction ID">
        </div>
        <button type="submit" class="btn btn-buy">Order on WhatsApp</button>
    </form>
</div>

<script>
    const products = [
        { name: "Premium Jeera", mrp: 750, img: ["https://images.unsplash.com/photo-1599311650742-99052069b2d9?w=300", "https://images.unsplash.com/photo-1626132647523-66f5bf380027?w=300"] },
        { name: "Shahi Loang", mrp: 1100, img: ["https://images.unsplash.com/photo-1615485290382-441e4d049cb5?w=300", "https://images.unsplash.com/photo-1596450514735-244027706da5?w=300"] },
        { name: "Green Elaichi", mrp: 3200, img: ["https://images.unsplash.com/photo-1601004890684-d8cbf643f5f2?w=300", "https://images.unsplash.com/photo-1599311650742-99052069b2d9?w=300"] },
        { name: "Black Pepper", mrp: 950, img: ["https://images.unsplash.com/photo-1596450514735-244027706da5?w=300", "https://images.unsplash.com/photo-1615485290382-441e4d049cb5?w=300"] }
    ];

    let cart = [];
    window.onpopstate = () => document.getElementById('cart-modal').classList.add('hidden');

    function renderProducts() {
        const list = document.getElementById('masala-list');
        products.forEach((p, idx) => {
            let sale = Math.round(p.mrp * 0.65);
            let imgs = p.img.map((s, i) => `<img src="${s}" class="slider-img img-${idx} ${i===0?'active':''}" loading="lazy">`).join('');
            list.innerHTML += `
                <div class="product-card">
                    <div class="img-box">${imgs}<button class="slider-btn prev" onclick="move(${idx},-1)">‚ùÆ</button><button class="slider-btn next" onclick="move(${idx},1)">‚ùØ</button></div>
                    <div class="details"><p class="p-name">${p.name}</p><p class="p-price">‚Çπ${sale}/kg</p>
                    <select id="q-${idx}"><option value="6">6kg</option><option value="10">10kg</option><option value="15">15kg</option></select>
                    <button class="btn" onclick="add(${idx})">Add to Cart</button></div>
                </div>`;
        });
    }

    function move(idx, s) {
        let imgs = document.querySelectorAll(`.img-${idx}`);
        let cur = Array.from(imgs).findIndex(i => i.classList.contains('active'));
        imgs[cur].classList.remove('active');
        imgs[(cur + s + imgs.length) % imgs.length].classList.add('active');
    }

    function add(idx) {
        const qty = document.getElementById(`q-${idx}`).value;
        const p = products[idx];
        cart.push({ n: p.name, q: qty, t: Math.round(p.mrp * 0.65) * qty });
        document.getElementById('count').innerText = cart.length;
        alert("Added!");
    }

    function openCart() {
        if(!cart.length) return alert("Empty!");
        history.pushState({p:'c'}, "", "#cart");
        document.getElementById('cart-modal').classList.remove('hidden');
        let h = ""; let t = 0;
        cart.forEach((i, idx) => { h += `<p style="font-size:0.9rem; margin-bottom:5px;">üì¶ ${i.n} (${i.q}kg) - ‚Çπ${i.t} <span onclick="del(${idx})" style="color:red; float:right;">‚úñ</span></p>`; t += i.t; });
        document.getElementById('items-list').innerHTML = h;
        document.getElementById('total').innerText = t;
        document.getElementById('hidden-data').value = JSON.stringify(cart);
    }

    function del(idx) { cart.splice(idx,1); if(!cart.length) window.history.back(); else openCart(); document.getElementById('count').innerText = cart.length; }

    function handleOrder() {
        const msg = encodeURIComponent("New Wholesale Order. Details sent to email.");
        setTimeout(() => location.href = "https://wa.me/918460722331?text=" + msg, 800);
        return true;
    }
</script>
</body>
</html>
